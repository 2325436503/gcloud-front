import{d as ne,h as m,aK as On,l as Bn,aS as _n,o as nn,v as ce,aT as $n,aU as Un,I as Mn,r as P,J as Oe,c as O,A as zn,ag as j,b9 as jn,N as Hn,f as K,b as J,g as E,aZ as Ye,j as de,M as ye,aR as Be,s as Vn,D as qn,x as tn,B as be,t as N,w as Ke,n as Ge,O as Xn,z as Wn}from"./index.090d1b34.js";import{c as Yn,N as Gn}from"./Checkbox.b58d1322.js";import{e as Zn,h as Ze,c as Jn,f as Je,a as Qn,V as et,N as nt}from"./index.cf1a054d.js";import{v as tt,w as lt,u as De,X as Qe}from"./index.5e4b8f88.js";import{p as ot,g as at}from"./index.a1c9fab8.js";import{b as U,a as rt}from"./color-to-class.6a5641e4.js";function ln(e){return typeof e=="string"?`s-${e}`:`n-${e}`}const it=ne({name:"Switcher",render(){return m("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},m("path",{d:"M12 8l10 8l-10 8z"}))}}),dt=e=>{const{borderRadiusSmall:l,hoverColor:c,pressedColor:i,primaryColor:d,textColor3:s,textColor2:y,textColorDisabled:x,fontSize:h}=e;return{fontSize:h,nodeBorderRadius:l,nodeColorHover:c,nodeColorPressed:i,nodeColorActive:_n(d,{alpha:.1}),arrowColor:s,nodeTextColor:y,nodeTextColorDisabled:x,loadingColor:d,dropMarkColor:d}},ct=On({name:"Tree",common:Bn,peers:{Checkbox:Yn,Scrollbar:tt,Empty:Zn},self:dt}),st=ct,on=nn("n-tree-select"),ke=nn("n-tree"),ut=ne({name:"NTreeSwitcher",props:{clsPrefix:{type:String,required:!0},expanded:Boolean,hide:Boolean,loading:Boolean,onClick:Function},setup(e){const{renderSwitcherIconRef:l}=ce(ke,null);return()=>{const{clsPrefix:c}=e;return m("span",{"data-switcher":!0,class:[`${c}-tree-node-switcher`,{[`${c}-tree-node-switcher--expanded`]:e.expanded,[`${c}-tree-node-switcher--hide`]:e.hide}],onClick:e.onClick},m("div",{class:`${c}-tree-node-switcher__icon`},m($n,null,{default:()=>{if(e.loading)return m(Un,{clsPrefix:c,key:"loading",radius:85,strokeWidth:20});const{value:i}=l;return i?i():m(Mn,{clsPrefix:c,key:"switcher"},{default:()=>m(it,null)})}})))}}}),ft=ne({name:"NTreeNodeCheckbox",props:{clsPrefix:{type:String,required:!0},right:Boolean,focusable:Boolean,disabled:Boolean,checked:Boolean,indeterminate:Boolean,onCheck:Function},setup(e){const l=ce(ke);function c(d){const{onCheck:s}=e;if(s)return s(d)}function i(d){e.indeterminate?c(!1):c(d)}return{handleUpdateValue:i,mergedTheme:l.mergedThemeRef}},render(){const{clsPrefix:e,mergedTheme:l,checked:c,indeterminate:i,disabled:d,focusable:s,handleUpdateValue:y}=this;return m("span",{class:[`${e}-tree-node-checkbox`,this.right&&`${e}-tree-node-checkbox--right`],"data-checkbox":!0},m(Gn,{focusable:s,disabled:d,theme:l.peers.Checkbox,themeOverrides:l.peerOverrides.Checkbox,checked:c,indeterminate:i,onUpdateChecked:y}))}}),ht=ne({name:"TreeNodeContent",props:{clsPrefix:{type:String,required:!0},disabled:Boolean,checked:Boolean,selected:Boolean,onClick:Function,onDragstart:Function,tmNode:{type:Object,required:!0},nodeProps:Object},setup(e){const{renderLabelRef:l,renderPrefixRef:c,renderSuffixRef:i,labelFieldRef:d}=ce(ke),s=P(null);function y(h){const{onClick:k}=e;k&&k(h)}function x(h){y(h)}return{selfRef:s,renderLabel:l,renderPrefix:c,renderSuffix:i,labelField:d,handleClick:x}},render(){const{clsPrefix:e,labelField:l,nodeProps:c,checked:i=!1,selected:d=!1,renderLabel:s,renderPrefix:y,renderSuffix:x,handleClick:h,onDragstart:k,tmNode:{rawNode:g,rawNode:{prefix:w,suffix:v,[l]:u}}}=this;return m("span",Object.assign({},c,{ref:"selfRef",class:[`${e}-tree-node-content`,c==null?void 0:c.class],onClick:h,draggable:k===void 0?void 0:!0,onDragstart:k}),y||w?m("div",{class:`${e}-tree-node-content__prefix`},y?y({option:g,selected:d,checked:i}):Oe(w)):null,m("div",{class:`${e}-tree-node-content__text`},s?s({option:g,selected:d,checked:i}):Oe(u)),x||v?m("div",{class:`${e}-tree-node-content__suffix`},x?x({option:g,selected:d,checked:i}):Oe(v)):null)}});function en({position:e,offsetLevel:l,indent:c,el:i}){const d={position:"absolute",boxSizing:"border-box",right:0};if(e==="inside")d.left=0,d.top=0,d.bottom=0,d.borderRadius="inherit",d.boxShadow="inset 0 0 0 2px var(--n-drop-mark-color)";else{const s=e==="before"?"top":"bottom";d[s]=0,d.left=`${i.offsetLeft+6-l*c}px`,d.height="2px",d.backgroundColor="var(--n-drop-mark-color)",d.transformOrigin=s,d.borderRadius="1px",d.transform=e==="before"?"translateY(-4px)":"translateY(4px)"}return m("div",{style:d})}function gt({dropPosition:e,node:l}){return l.isLeaf===!1||l.children?!0:e!=="inside"}const vt=ne({name:"TreeNode",props:{clsPrefix:{type:String,required:!0},tmNode:{type:Object,required:!0}},setup(e){const l=ce(ke),{droppingNodeParentRef:c,droppingMouseNodeRef:i,draggingNodeRef:d,droppingPositionRef:s,droppingOffsetLevelRef:y,nodePropsRef:x,indentRef:h,blockLineRef:k,checkboxPlacementRef:g,checkOnClickRef:w}=l,v=O(()=>l.disabledRef.value||e.tmNode.disabled),u=O(()=>{const{value:a}=x;if(!!a)return a({option:e.tmNode.rawNode})}),b=P(null),p={value:null};zn(()=>{p.value=b.value.$el});function D(){const{tmNode:a}=e;if(!a.isLeaf&&!a.shallowLoaded){if(!l.loadingKeysRef.value.has(a.key))l.loadingKeysRef.value.add(a.key);else return;const{onLoadRef:{value:S}}=l;S&&S(a.rawNode).then(()=>{l.handleSwitcherClick(a)}).finally(()=>{l.loadingKeysRef.value.delete(a.key)})}else l.handleSwitcherClick(a)}const B=j(()=>!e.tmNode.disabled&&l.selectableRef.value&&(l.internalTreeSelect?l.mergedCheckStrategyRef.value!=="child"||l.multipleRef.value&&l.cascadeRef.value||e.tmNode.isLeaf:!0)),L=j(()=>l.checkableRef.value&&(l.cascadeRef.value||l.mergedCheckStrategyRef.value!=="child"||e.tmNode.isLeaf)),_=j(()=>l.displayedCheckedKeysRef.value.includes(e.tmNode.key)),M=j(()=>{const{value:a}=L;if(!a)return!1;const{value:S}=w;return typeof S=="boolean"?S:S(e.tmNode.rawNode)});function X(a){const{value:S}=l.expandOnClickRef,{value:C}=B,{value:H}=M;if(!C&&!S&&!H||Ze(a,"checkbox")||Ze(a,"switcher"))return;const{tmNode:oe}=e;C&&l.handleSelect(oe),S&&!oe.isLeaf&&D(),H&&me(!_.value)}function se(a){var S,C;k.value||(v.value||X(a),(C=(S=u.value)===null||S===void 0?void 0:S.onClick)===null||C===void 0||C.call(S,a))}function te(a){var S,C;!k.value||(v.value||X(a),(C=(S=u.value)===null||S===void 0?void 0:S.onClick)===null||C===void 0||C.call(S,a))}function me(a){l.handleCheck(e.tmNode,a)}function le(a){l.handleDragStart({event:a,node:e.tmNode})}function ue(a){a.currentTarget===a.target&&l.handleDragEnter({event:a,node:e.tmNode})}function xe(a){a.preventDefault(),l.handleDragOver({event:a,node:e.tmNode})}function Le(a){l.handleDragEnd({event:a,node:e.tmNode})}function z(a){a.currentTarget===a.target&&l.handleDragLeave({event:a,node:e.tmNode})}function Y(a){a.preventDefault(),s.value!==null&&l.handleDrop({event:a,node:e.tmNode,dropPosition:s.value})}return{showDropMark:j(()=>{const{value:a}=d;if(!a)return;const{value:S}=s;if(!S)return;const{value:C}=i;if(!C)return;const{tmNode:H}=e;return H.key===C.key}),showDropMarkAsParent:j(()=>{const{value:a}=c;if(!a)return!1;const{tmNode:S}=e,{value:C}=s;return C==="before"||C==="after"?a.key===S.key:!1}),pending:j(()=>l.pendingNodeKeyRef.value===e.tmNode.key),loading:j(()=>l.loadingKeysRef.value.has(e.tmNode.key)),highlight:j(()=>{var a;return(a=l.highlightKeySetRef.value)===null||a===void 0?void 0:a.has(e.tmNode.key)}),checked:_,indeterminate:j(()=>l.displayedIndeterminateKeysRef.value.includes(e.tmNode.key)),selected:j(()=>l.mergedSelectedKeysRef.value.includes(e.tmNode.key)),expanded:j(()=>l.mergedExpandedKeysRef.value.includes(e.tmNode.key)),disabled:v,checkable:L,mergedCheckOnClick:M,checkboxDisabled:O(()=>!!e.tmNode.rawNode.checkboxDisabled),selectable:B,expandOnClick:l.expandOnClickRef,internalScrollable:l.internalScrollableRef,draggable:l.draggableRef,blockLine:k,nodeProps:u,checkboxFocusable:l.internalCheckboxFocusableRef,droppingPosition:s,droppingOffsetLevel:y,indent:h,checkboxPlacement:g,contentInstRef:b,contentElRef:p,handleCheck:me,handleDrop:Y,handleDragStart:le,handleDragEnter:ue,handleDragOver:xe,handleDragEnd:Le,handleDragLeave:z,handleLineClick:te,handleContentClick:se,handleSwitcherClick:D}},render(){const{tmNode:e,clsPrefix:l,checkable:c,expandOnClick:i,selectable:d,selected:s,checked:y,highlight:x,draggable:h,blockLine:k,indent:g,disabled:w,pending:v,internalScrollable:u,nodeProps:b,checkboxPlacement:p}=this,D=h&&!w?{onDragenter:this.handleDragEnter,onDragleave:this.handleDragLeave,onDragend:this.handleDragEnd,onDrop:this.handleDrop,onDragover:this.handleDragOver}:void 0,B=u?ln(e.key):void 0,L=p==="right",_=c?m(ft,{right:L,focusable:this.checkboxFocusable,disabled:w||this.checkboxDisabled,clsPrefix:l,checked:this.checked,indeterminate:this.indeterminate,onCheck:this.handleCheck}):null;return m("div",Object.assign({class:`${l}-tree-node-wrapper`},D),m("div",Object.assign({},k?b:void 0,{class:[`${l}-tree-node`,{[`${l}-tree-node--selected`]:s,[`${l}-tree-node--checkable`]:c,[`${l}-tree-node--highlight`]:x,[`${l}-tree-node--pending`]:v,[`${l}-tree-node--disabled`]:w,[`${l}-tree-node--selectable`]:d,[`${l}-tree-node--clickable`]:d||i||this.mergedCheckOnClick},b==null?void 0:b.class],"data-key":B,draggable:h&&k,onClick:this.handleLineClick,onDragstart:h&&k&&!w?this.handleDragStart:void 0}),jn(e.level,m("div",{class:`${l}-tree-node-indent`},m("div",{style:{width:`${g}px`}}))),m(ut,{clsPrefix:l,expanded:this.expanded,loading:this.loading,hide:e.isLeaf,onClick:this.handleSwitcherClick}),L?null:_,m(ht,{ref:"contentInstRef",clsPrefix:l,checked:y,selected:s,onClick:this.handleContentClick,nodeProps:k?void 0:b,onDragstart:h&&!k&&!w?this.handleDragStart:void 0,tmNode:e}),h?this.showDropMark?en({el:this.contentElRef.value,position:this.droppingPosition,offsetLevel:this.droppingOffsetLevel,indent:g}):this.showDropMarkAsParent?en({el:this.contentElRef.value,position:"inside",offsetLevel:this.droppingOffsetLevel,indent:g}):null:null,L?_:null))}}),an=vt;function rn(e,l,c,i){e==null||e.forEach(d=>{c(d),rn(d[l],l,c,i),i(d)})}function yt(e,l,c,i,d){const s=new Set,y=new Set,x=[];return rn(e,i,h=>{if(x.push(h),d(l,h)){y.add(h[c]);for(let k=x.length-2;k>=0;--k)if(!s.has(x[k][c]))s.add(x[k][c]);else return}},()=>{x.pop()}),{expandedKeys:Array.from(s),highlightKeySet:y}}if(lt&&Image){const e=new Image;e.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="}function bt(e,l,c,i,d){const s=new Set,y=new Set,x=new Set,h=[],k=[],g=[];function w(u){u.forEach(b=>{if(g.push(b),l(c,b)){s.add(b[i]),x.add(b[i]);for(let D=g.length-2;D>=0;--D){const B=g[D][i];if(!y.has(B))y.add(B),s.has(B)&&s.delete(B);else break}}const p=b[d];p&&w(p),g.pop()})}w(e);function v(u,b){u.forEach(p=>{const D=p[i],B=s.has(D),L=y.has(D);if(!B&&!L)return;const _=p[d];if(_)if(B)b.push(p);else{h.push(D);const M=Object.assign(Object.assign({},p),{[d]:[]});b.push(M),v(_,M[d])}else b.push(p)})}return v(e,k),{filteredTree:k,highlightKeySet:x,expandedKeys:h}}function kt({props:e,fNodesRef:l,mergedExpandedKeysRef:c,mergedSelectedKeysRef:i,handleSelect:d,handleSwitcherClick:s}){const{value:y}=i,x=ce(on,null),h=x?x.pendingNodeKeyRef:P(y.length?y[y.length-1]:null);function k(g){if(!e.keyboard)return;const{value:w}=h;if(w===null){if((g.key==="ArrowDown"||g.key==="ArrowUp")&&g.preventDefault(),["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"].includes(g.key)&&w===null){const{value:v}=l;let u=0;for(;u<v.length;){if(!v[u].disabled){h.value=v[u].key;break}u+=1}}}else{const{value:v}=l;let u=v.findIndex(b=>b.key===w);if(!~u)return;if(g.key==="Enter")d(v[u]);else if(g.key==="ArrowDown")for(g.preventDefault(),u+=1;u<v.length;){if(!v[u].disabled){h.value=v[u].key;break}u+=1}else if(g.key==="ArrowUp")for(g.preventDefault(),u-=1;u>=0;){if(!v[u].disabled){h.value=v[u].key;break}u-=1}else if(g.key==="ArrowLeft"){const b=v[u];if(b.isLeaf||!c.value.includes(w)){const p=b.getParent();p&&(h.value=p.key)}else s(b)}else if(g.key==="ArrowRight"){const b=v[u];if(b.isLeaf)return;if(!c.value.includes(w))s(b);else for(u+=1;u<v.length;){if(!v[u].disabled){h.value=v[u].key;break}u+=1}}}}return{pendingNodeKeyRef:h,handleKeydown:k}}const mt=ne({name:"TreeMotionWrapper",props:{clsPrefix:{type:String,required:!0},height:Number,nodes:{type:Array,required:!0},mode:{type:String,required:!0},onAfterEnter:{type:Function,required:!0}},render(){const{clsPrefix:e}=this;return m(Hn,{onAfterEnter:this.onAfterEnter,appear:!0,reverse:this.mode==="collapse"},{default:()=>m("div",{class:[`${e}-tree-motion-wrapper`,`${e}-tree-motion-wrapper--${this.mode}`],style:{height:ot(this.height)}},this.nodes.map(l=>m(an,{clsPrefix:e,tmNode:l})))})}}),xt=K("tree",`
 font-size: var(--n-font-size);
 outline: none;
`,[J("ul, li",`
 margin: 0;
 padding: 0;
 list-style: none;
 `),J(">",[K("tree-node",[J("&:first-child",{marginTop:0})])]),K("tree-node-indent",`
 flex-grow: 0;
 flex-shrink: 0;
 height: 0;
 `),K("tree-motion-wrapper",[E("expand",[Ye({duration:"0.2s"})]),E("collapse",[Ye({duration:"0.2s",reverse:!0})])]),K("tree-node-wrapper",`
 box-sizing: border-box;
 padding: 3px 0;
 `),K("tree-node",`
 position: relative;
 display: flex;
 border-radius: var(--n-node-border-radius);
 transition: background-color .3s var(--n-bezier);
 `,[E("highlight",[K("tree-node-content",[de("text",{borderBottomColor:"var(--n-node-text-color-disabled)"})])]),E("disabled",[K("tree-node-content",`
 color: var(--n-node-text-color-disabled);
 cursor: not-allowed;
 `)]),ye("disabled",[E("clickable",[K("tree-node-content",`
 cursor: pointer;
 `)])])]),E("block-node",[K("tree-node-content",`
 flex: 1;
 min-width: 0;
 `)]),ye("block-line",[K("tree-node",[ye("disabled",[K("tree-node-content",[J("&:hover",{backgroundColor:"var(--n-node-color-hover)"})]),E("selectable",[K("tree-node-content",[J("&:active",{backgroundColor:"var(--n-node-color-pressed)"})])]),E("pending",[K("tree-node-content",`
 background-color: var(--n-node-color-hover);
 `)]),E("selected",[K("tree-node-content",{backgroundColor:"var(--n-node-color-active)"})])])])]),E("block-line",[K("tree-node",[ye("disabled",[J("&:hover",{backgroundColor:"var(--n-node-color-hover)"}),E("pending",`
 background-color: var(--n-node-color-hover);
 `),E("selectable",[ye("selected",[J("&:active",{backgroundColor:"var(--n-node-color-pressed)"})])]),E("selected",{backgroundColor:"var(--n-node-color-active)"})]),E("disabled",`
 cursor: not-allowed;
 `)])]),K("tree-node-switcher",`
 cursor: pointer;
 display: inline-flex;
 flex-shrink: 0;
 height: 24px;
 width: 24px;
 align-items: center;
 justify-content: center;
 transition: transform .15s var(--n-bezier);
 vertical-align: bottom;
 `,[de("icon",`
 position: relative;
 height: 14px;
 width: 14px;
 display: flex;
 color: var(--n-arrow-color);
 transition: color .3s var(--n-bezier);
 font-size: 14px;
 `,[K("icon",[Be()]),K("base-loading",`
 color: var(--n-loading-color);
 position: absolute;
 left: 0;
 top: 0;
 right: 0;
 bottom: 0;
 `,[Be()]),K("base-icon",[Be()])]),E("hide",{visibility:"hidden"}),E("expanded",{transform:"rotate(90deg)"})]),K("tree-node-checkbox",`
 display: inline-flex;
 height: 24px;
 width: 16px;
 vertical-align: bottom;
 align-items: center;
 justify-content: center;
 margin-right: 4px;
 `,[E("right","margin-left: 4px;")]),E("checkable",[K("tree-node-content",`
 padding: 0 6px;
 `)]),K("tree-node-content",`
 position: relative;
 display: inline-flex;
 align-items: center;
 min-height: 24px;
 box-sizing: border-box;
 line-height: 1.5;
 vertical-align: bottom;
 padding: 0 6px 0 4px;
 cursor: default;
 border-radius: var(--n-node-border-radius);
 text-decoration-color: #0000;
 text-decoration-line: underline;
 color: var(--n-node-text-color);
 transition:
 color .3s var(--n-bezier),
 text-decoration-color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 `,[J("&:last-child",{marginBottom:0}),de("prefix",`
 display: inline-flex;
 margin-right: 8px;
 `),de("text",`
 border-bottom: 1px solid #0000;
 transition: border-color .3s var(--n-bezier);
 flex-grow: 1;
 max-width: 100%;
 `),de("suffix",`
 display: inline-flex;
 `)]),de("empty","margin: auto;")]);var pt=globalThis&&globalThis.__awaiter||function(e,l,c,i){function d(s){return s instanceof c?s:new c(function(y){y(s)})}return new(c||(c=Promise))(function(s,y){function x(g){try{k(i.next(g))}catch(w){y(w)}}function h(g){try{k(i.throw(g))}catch(w){y(w)}}function k(g){g.done?s(g.value):d(g.value).then(x,h)}k((i=i.apply(e,l||[])).next())})};const Te=30;function wt(e,l,c){return{getIsGroup(){return!1},getKey(i){return i[e]},getChildren(i){return i[l]},getDisabled(i){return!!(i[c]||i.checkboxDisabled)}}}const Ct={allowCheckingNotLoaded:Boolean,filter:Function,defaultExpandAll:Boolean,expandedKeys:Array,keyField:{type:String,default:"key"},labelField:{type:String,default:"label"},childrenField:{type:String,default:"children"},disabledField:{type:String,default:"disabled"},defaultExpandedKeys:{type:Array,default:()=>[]},indeterminateKeys:Array,renderSwitcherIcon:Function,onUpdateIndeterminateKeys:[Function,Array],"onUpdate:indeterminateKeys":[Function,Array],onUpdateExpandedKeys:[Function,Array],"onUpdate:expandedKeys":[Function,Array]},Rt=Object.assign(Object.assign(Object.assign(Object.assign({},tn.props),{accordion:Boolean,showIrrelevantNodes:{type:Boolean,default:!0},data:{type:Array,default:()=>[]},expandOnDragenter:{type:Boolean,default:!0},expandOnClick:Boolean,checkOnClick:{type:[Boolean,Function],default:!1},cancelable:{type:Boolean,default:!0},checkable:Boolean,draggable:Boolean,blockNode:Boolean,blockLine:Boolean,disabled:Boolean,checkedKeys:Array,defaultCheckedKeys:{type:Array,default:()=>[]},selectedKeys:Array,defaultSelectedKeys:{type:Array,default:()=>[]},multiple:Boolean,pattern:{type:String,default:""},onLoad:Function,cascade:Boolean,selectable:{type:Boolean,default:!0},indent:{type:Number,default:16},allowDrop:{type:Function,default:gt},animated:{type:Boolean,default:!0},checkboxPlacement:{type:String,default:"left"},virtualScroll:Boolean,watchProps:Array,renderLabel:Function,renderPrefix:Function,renderSuffix:Function,nodeProps:Function,keyboard:{type:Boolean,default:!0},onDragenter:[Function,Array],onDragleave:[Function,Array],onDragend:[Function,Array],onDragstart:[Function,Array],onDragover:[Function,Array],onDrop:[Function,Array],onUpdateCheckedKeys:[Function,Array],"onUpdate:checkedKeys":[Function,Array],onUpdateSelectedKeys:[Function,Array],"onUpdate:selectedKeys":[Function,Array]}),Ct),{internalTreeSelect:Boolean,internalScrollable:Boolean,internalScrollablePadding:String,internalRenderEmpty:Function,internalHighlightKeySet:Object,internalUnifySelectCheck:Boolean,internalCheckboxFocusable:{type:Boolean,default:!0},internalFocusable:{type:Boolean,default:!0},checkStrategy:{type:String,default:"all"},leafOnly:Boolean}),At=ne({name:"Tree",props:Rt,setup(e){const{mergedClsPrefixRef:l,inlineThemeDisabled:c,mergedRtlRef:i}=Vn(e),d=qn("Tree",i,l),s=tn("Tree","-tree",xt,st,e,l),y=P(null),x=P(null),h=P(null);function k(){var n;return(n=h.value)===null||n===void 0?void 0:n.listElRef}function g(){var n;return(n=h.value)===null||n===void 0?void 0:n.itemsElRef}const w=O(()=>{const{pattern:n}=e;return n?!n.length||!Ae.value?{filteredTree:e.data,highlightKeySet:null,expandedKeys:void 0}:bt(e.data,Ae.value,n,e.keyField,e.childrenField):{filteredTree:e.data,highlightKeySet:null,expandedKeys:void 0}}),v=O(()=>Jn(e.showIrrelevantNodes?e.data:w.value.filteredTree,wt(e.keyField,e.childrenField,e.disabledField))),u=ce(on,null),b=e.internalTreeSelect?u.dataTreeMate:v,{watchProps:p}=e,D=P([]);p!=null&&p.includes("defaultCheckedKeys")?be(()=>{D.value=e.defaultCheckedKeys}):D.value=e.defaultCheckedKeys;const B=N(e,"checkedKeys"),L=De(B,D),_=O(()=>b.value.getCheckedKeys(L.value,{cascade:e.cascade,allowNotLoaded:e.allowCheckingNotLoaded})),M=O(()=>e.leafOnly?"child":e.checkStrategy),X=O(()=>_.value.checkedKeys),se=O(()=>{const{indeterminateKeys:n}=e;return n!==void 0?n:_.value.indeterminateKeys}),te=P([]);p!=null&&p.includes("defaultSelectedKeys")?be(()=>{te.value=e.defaultSelectedKeys}):te.value=e.defaultSelectedKeys;const me=N(e,"selectedKeys"),le=De(me,te),ue=P([]),xe=n=>{ue.value=e.defaultExpandAll?b.value.getNonLeafKeys():n===void 0?e.defaultExpandedKeys:n};p!=null&&p.includes("defaultExpandedKeys")?be(()=>xe(void 0)):be(()=>xe(e.defaultExpandedKeys));const Le=N(e,"expandedKeys"),z=De(Le,ue),Y=O(()=>v.value.getFlattenedNodes(z.value)),{pendingNodeKeyRef:a,handleKeydown:S}=kt({props:e,mergedSelectedKeysRef:le,fNodesRef:Y,mergedExpandedKeysRef:z,handleSelect:Pe,handleSwitcherClick:ze});let C=null,H=null;const oe=P(new Set),dn=O(()=>e.internalHighlightKeySet||w.value.highlightKeySet),cn=De(dn,oe),pe=P(new Set),sn=O(()=>z.value.filter(n=>!pe.value.has(n)));let _e=0;const fe=P(null),we=P(null),Ce=P(null),Re=P(null),Se=P(0),un=O(()=>{const{value:n}=we;return n?n.parent:null}),Ae=O(()=>{const{filter:n}=e;if(n)return n;const{labelField:t}=e;return(o,r)=>{if(!o.length)return!0;const f=r[t];return typeof f=="string"?f.toLowerCase().includes(o.toLowerCase()):!1}});Ke(N(e,"data"),()=>{pe.value.clear(),a.value=null,ge()},{deep:!1});let he;Ke(N(e,"pattern"),(n,t)=>{if(e.showIrrelevantNodes)if(he=void 0,n){const{expandedKeys:o,highlightKeySet:r}=yt(e.data,e.pattern,e.keyField,e.childrenField,Ae.value);oe.value=r,re(o,V(o))}else oe.value=new Set;else if(!n.length)he!==void 0&&re(he,V(he));else{t.length||(he=z.value);const{expandedKeys:o}=w.value;o!==void 0&&re(o,V(o))}});function $e(n){return pt(this,void 0,void 0,function*(){const{onLoad:t}=e;if(!t)return yield Promise.resolve();const{value:o}=pe;return yield new Promise(r=>{o.has(n.key)||(o.add(n.key),t(n.rawNode).then(()=>{o.delete(n.key),r()}).catch(f=>{console.error(f),ve()}))})})}be(()=>{var n;const{value:t}=v;if(!t)return;const{getNode:o}=t;(n=z.value)===null||n===void 0||n.forEach(r=>{const f=o(r);f&&!f.shallowLoaded&&$e(f)})});const ae=P(!1),G=P([]);Ke(sn,(n,t)=>{if(!e.animated){Ge(Ne);return}const o=new Set(t);let r=null,f=null;for(const T of n)if(!o.has(T)){if(r!==null)return;r=T}const F=new Set(n);for(const T of t)if(!F.has(T)){if(f!==null)return;f=T}if(r===null&&f===null)return;const{virtualScroll:A}=e,W=(A?h.value.listElRef:y.value).offsetHeight,ee=Math.ceil(W/Te)+1;let q;if(r!==null&&(q=t),f!==null&&(q===void 0?q=n:q=q.filter(T=>T!==f)),ae.value=!0,G.value=v.value.getFlattenedNodes(q),r!==null){const T=G.value.findIndex(I=>I.key===r);if(~T){const I=G.value[T].children;if(I){const Z=Je(I,n);G.value.splice(T+1,0,{__motion:!0,mode:"expand",height:A?Z.length*Te:void 0,nodes:A?Z.slice(0,ee):Z})}}}if(f!==null){const T=G.value.findIndex(I=>I.key===f);if(~T){const I=G.value[T].children;if(!I)return;ae.value=!0;const Z=Je(I,n);G.value.splice(T+1,0,{__motion:!0,mode:"collapse",height:A?Z.length*Te:void 0,nodes:A?Z.slice(0,ee):Z})}}});const fn=O(()=>Qn(Y.value)),hn=O(()=>ae.value?G.value:Y.value);function Ne(){const{value:n}=x;n&&n.sync()}function gn(){ae.value=!1,e.virtualScroll&&Ge(Ne)}function V(n){const{getNode:t}=b.value;return n.map(o=>{var r;return((r=t(o))===null||r===void 0?void 0:r.rawNode)||null})}function re(n,t){const{"onUpdate:expandedKeys":o,onUpdateExpandedKeys:r}=e;ue.value=n,o&&U(o,n,t),r&&U(r,n,t)}function Ue(n,t){const{"onUpdate:checkedKeys":o,onUpdateCheckedKeys:r}=e;D.value=n,r&&U(r,n,t),o&&U(o,n,t)}function vn(n,t){const{"onUpdate:indeterminateKeys":o,onUpdateIndeterminateKeys:r}=e;o&&U(o,n,t),r&&U(r,n,t)}function Ee(n,t){const{"onUpdate:selectedKeys":o,onUpdateSelectedKeys:r}=e;te.value=n,r&&U(r,n,t),o&&U(o,n,t)}function yn(n){const{onDragenter:t}=e;t&&U(t,n)}function bn(n){const{onDragleave:t}=e;t&&U(t,n)}function kn(n){const{onDragend:t}=e;t&&U(t,n)}function mn(n){const{onDragstart:t}=e;t&&U(t,n)}function xn(n){const{onDragover:t}=e;t&&U(t,n)}function pn(n){const{onDrop:t}=e;t&&U(t,n)}function ge(){wn(),Q()}function wn(){fe.value=null}function Q(){Se.value=0,we.value=null,Ce.value=null,Re.value=null,ve()}function ve(){C&&(window.clearTimeout(C),C=null),H=null}function Me(n,t){if(e.disabled||n.disabled)return;if(e.internalUnifySelectCheck&&!e.multiple){Pe(n);return}const{checkedKeys:o,indeterminateKeys:r}=b.value[t?"check":"uncheck"](n.key,X.value,{cascade:e.cascade,checkStrategy:M.value,allowNotLoaded:e.allowCheckingNotLoaded});Ue(o,V(o)),vn(r,V(r))}function Cn(n){if(e.disabled)return;const{key:t}=n,{value:o}=z,r=o.findIndex(f=>f===t);if(~r){const f=Array.from(o);f.splice(r,1),re(f,V(f))}else{const f=v.value.getNode(t);if(!f||f.isLeaf)return;let F;if(e.accordion){const A=new Set(n.siblings.map(({key:W})=>W));F=o.filter(W=>!A.has(W)),F.push(t)}else F=o.concat(t);re(F,V(F))}}function ze(n){e.disabled||ae.value||Cn(n)}function Pe(n){if(!(e.disabled||!e.selectable)){if(a.value=n.key,e.internalUnifySelectCheck){const{value:{checkedKeys:t,indeterminateKeys:o}}=_;e.multiple?Me(n,!(t.includes(n.key)||o.includes(n.key))):Ue([n.key],V([n.key]))}if(e.multiple){const t=Array.from(le.value),o=t.findIndex(r=>r===n.key);~o?e.cancelable&&t.splice(o,1):~o||t.push(n.key),Ee(t,V(t))}else le.value.includes(n.key)?e.cancelable&&Ee([],[]):Ee([n.key],V([n.key]))}}function Rn(n){if(C&&(window.clearTimeout(C),C=null),n.isLeaf)return;H=n.key;const t=()=>{if(H!==n.key)return;const{value:o}=Ce;if(o&&o.key===n.key&&!z.value.includes(n.key)){const r=z.value.concat(n.key);re(r,V(r))}C=null,H=null};n.shallowLoaded?C=window.setTimeout(()=>{t()},1e3):C=window.setTimeout(()=>{$e(n).then(()=>{t()})},1e3)}function Sn({event:n,node:t}){!e.draggable||e.disabled||t.disabled||(je({event:n,node:t},!1),yn({event:n,node:t.rawNode}))}function Nn({event:n,node:t}){!e.draggable||e.disabled||t.disabled||bn({event:n,node:t.rawNode})}function Kn(n){n.target===n.currentTarget&&Q()}function Dn({event:n,node:t}){ge(),!(!e.draggable||e.disabled||t.disabled)&&kn({event:n,node:t.rawNode})}function Tn({event:n,node:t}){!e.draggable||e.disabled||t.disabled||(_e=n.clientX,fe.value=t,mn({event:n,node:t.rawNode}))}function je({event:n,node:t},o=!0){var r;if(!e.draggable||e.disabled||t.disabled)return;const{value:f}=fe;if(!f)return;const{allowDrop:F,indent:A}=e;o&&xn({event:n,node:t.rawNode});const W=n.currentTarget,{height:ee,top:q}=W.getBoundingClientRect(),T=n.clientY-q;let I;F({node:t.rawNode,dropPosition:"inside",phase:"drag"})?T<=8?I="before":T>=ee-8?I="after":I="inside":T<=ee/2?I="before":I="after";const{value:In}=fn;let R,$;const Fe=In(t.key);if(Fe===null){Q();return}let qe=!1;I==="inside"?(R=t,$="inside"):I==="before"?t.isFirstChild?(R=t,$="before"):(R=Y.value[Fe-1],$="after"):(R=t,$="after"),!R.isLeaf&&z.value.includes(R.key)&&(qe=!0,$==="after"&&(R=Y.value[Fe+1],R?$="before":(R=t,$="inside")));const Xe=R;if(Ce.value=Xe,!qe&&f.isLastChild&&f.key===R.key&&($="after"),$==="after"){let We=_e-n.clientX,Ie=0;for(;We>=A/2&&R.parent!==null&&R.isLastChild&&Ie<1;)We-=A,Ie+=1,R=R.parent;Se.value=Ie}else Se.value=0;if((f.contains(R)||$==="inside"&&((r=f.parent)===null||r===void 0?void 0:r.key)===R.key)&&!(f.key===Xe.key&&f.key===R.key)){Q();return}if(!F({node:R.rawNode,dropPosition:$,phase:"drag"})){Q();return}if(f.key===R.key)ve();else if(H!==R.key)if($==="inside"){if(e.expandOnDragenter){if(Rn(R),!R.shallowLoaded&&H!==R.key){ge();return}}else if(!R.shallowLoaded){ge();return}}else ve();else $!=="inside"&&ve();Re.value=$,we.value=R}function Ln({event:n,node:t,dropPosition:o}){if(!e.draggable||e.disabled||t.disabled)return;const{value:r}=fe,{value:f}=we,{value:F}=Re;if(!(!r||!f||!F)&&!!e.allowDrop({node:f.rawNode,dropPosition:F,phase:"drag"})&&r.key!==f.key){if(F==="before"){const A=r.getNext({includeDisabled:!0});if(A&&A.key===f.key){Q();return}}if(F==="after"){const A=r.getPrev({includeDisabled:!0});if(A&&A.key===f.key){Q();return}}pn({event:n,node:f.rawNode,dragNode:r.rawNode,dropPosition:o}),ge()}}function An(){Ne()}function En(){Ne()}function Pn(n){var t;if(e.virtualScroll||e.internalScrollable){const{value:o}=x;if(!((t=o==null?void 0:o.containerRef)===null||t===void 0)&&t.contains(n.relatedTarget))return;a.value=null}else{const{value:o}=y;if(o!=null&&o.contains(n.relatedTarget))return;a.value=null}}Ke(a,n=>{var t,o;if(n!==null){if(e.virtualScroll)(t=h.value)===null||t===void 0||t.scrollTo({key:n});else if(e.internalScrollable){const{value:r}=x;if(r===null)return;const f=(o=r.contentRef)===null||o===void 0?void 0:o.querySelector(`[data-key="${ln(n)}"]`);if(!f)return;r.scrollTo({el:f})}}}),Xn(ke,{loadingKeysRef:pe,highlightKeySetRef:cn,displayedCheckedKeysRef:X,displayedIndeterminateKeysRef:se,mergedSelectedKeysRef:le,mergedExpandedKeysRef:z,mergedThemeRef:s,mergedCheckStrategyRef:M,nodePropsRef:N(e,"nodeProps"),disabledRef:N(e,"disabled"),checkableRef:N(e,"checkable"),selectableRef:N(e,"selectable"),expandOnClickRef:N(e,"expandOnClick"),onLoadRef:N(e,"onLoad"),draggableRef:N(e,"draggable"),blockLineRef:N(e,"blockLine"),indentRef:N(e,"indent"),cascadeRef:N(e,"cascade"),checkOnClickRef:N(e,"checkOnClick"),checkboxPlacementRef:e.checkboxPlacement,droppingMouseNodeRef:Ce,droppingNodeParentRef:un,draggingNodeRef:fe,droppingPositionRef:Re,droppingOffsetLevelRef:Se,fNodesRef:Y,pendingNodeKeyRef:a,internalScrollableRef:N(e,"internalScrollable"),internalCheckboxFocusableRef:N(e,"internalCheckboxFocusable"),internalTreeSelect:e.internalTreeSelect,renderLabelRef:N(e,"renderLabel"),renderPrefixRef:N(e,"renderPrefix"),renderSuffixRef:N(e,"renderSuffix"),renderSwitcherIconRef:N(e,"renderSwitcherIcon"),labelFieldRef:N(e,"labelField"),multipleRef:N(e,"multiple"),handleSwitcherClick:ze,handleDragEnd:Dn,handleDragEnter:Sn,handleDragLeave:Nn,handleDragStart:Tn,handleDrop:Ln,handleDragOver:je,handleSelect:Pe,handleCheck:Me});function Fn(n){var t;(t=h.value)===null||t===void 0||t.scrollTo(n)}const He={handleKeydown:S,scrollTo:Fn},Ve=O(()=>{const{common:{cubicBezierEaseInOut:n},self:{fontSize:t,nodeBorderRadius:o,nodeColorHover:r,nodeColorPressed:f,nodeColorActive:F,arrowColor:A,loadingColor:W,nodeTextColor:ee,nodeTextColorDisabled:q,dropMarkColor:T}}=s.value;return{"--n-arrow-color":A,"--n-loading-color":W,"--n-bezier":n,"--n-font-size":t,"--n-node-border-radius":o,"--n-node-color-active":F,"--n-node-color-hover":r,"--n-node-color-pressed":f,"--n-node-text-color":ee,"--n-node-text-color-disabled":q,"--n-drop-mark-color":T}}),ie=c?Wn("tree",void 0,Ve,e):void 0;return{mergedClsPrefix:l,mergedTheme:s,rtlEnabled:d,fNodes:hn,aip:ae,selfElRef:y,virtualListInstRef:h,scrollbarInstRef:x,handleFocusout:Pn,handleDragLeaveTree:Kn,handleScroll:An,getScrollContainer:k,getScrollContent:g,handleAfterEnter:gn,handleResize:En,handleKeydown:He.handleKeydown,scrollTo:He.scrollTo,cssVars:c?void 0:Ve,themeClass:ie==null?void 0:ie.themeClass,onRender:ie==null?void 0:ie.onRender}},render(){var e;const{fNodes:l,internalRenderEmpty:c}=this;if(!l.length&&c)return c();const{mergedClsPrefix:i,blockNode:d,blockLine:s,draggable:y,disabled:x,internalFocusable:h,checkable:k,handleKeydown:g,rtlEnabled:w,handleFocusout:v}=this,u=h&&!x,b=u?"0":void 0,p=[`${i}-tree`,w&&`${i}-tree--rtl`,k&&`${i}-tree--checkable`,(s||d)&&`${i}-tree--block-node`,s&&`${i}-tree--block-line`],D=L=>"__motion"in L?m(mt,{height:L.height,nodes:L.nodes,clsPrefix:i,mode:L.mode,onAfterEnter:this.handleAfterEnter}):m(an,{key:L.key,tmNode:L,clsPrefix:i});if(this.virtualScroll){const{mergedTheme:L,internalScrollablePadding:_}=this,M=at(_||"0");return m(Qe,{ref:"scrollbarInstRef",onDragleave:y?this.handleDragLeaveTree:void 0,container:this.getScrollContainer,content:this.getScrollContent,class:p,theme:L.peers.Scrollbar,themeOverrides:L.peerOverrides.Scrollbar,tabindex:b,onKeydown:u?g:void 0,onFocusout:u?v:void 0},{default:()=>{var X;return(X=this.onRender)===null||X===void 0||X.call(this),m(et,{ref:"virtualListInstRef",items:this.fNodes,itemSize:Te,ignoreItemResize:this.aip,paddingTop:M.top,paddingBottom:M.bottom,class:this.themeClass,style:[this.cssVars,{paddingLeft:M.left,paddingRight:M.right}],onScroll:this.handleScroll,onResize:this.handleResize,showScrollbar:!1,itemResizable:!0},{default:({item:se})=>D(se)})}})}const{internalScrollable:B}=this;return p.push(this.themeClass),(e=this.onRender)===null||e===void 0||e.call(this),B?m(Qe,{class:p,tabindex:b,onKeydown:u?g:void 0,onFocusout:u?v:void 0,style:this.cssVars,contentStyle:{padding:this.internalScrollablePadding}},{default:()=>m("div",{onDragleave:y?this.handleDragLeaveTree:void 0,ref:"selfElRef"},this.fNodes.map(D))}):m("div",{class:p,tabindex:b,ref:"selfElRef",style:this.cssVars,onKeydown:u?g:void 0,onFocusout:u?v:void 0,onDragleave:y?this.handleDragLeaveTree:void 0},l.length?l.map(D):rt(this.$slots.empty,()=>[m(nt,{class:`${i}-tree__empty`,theme:this.mergedTheme.peers.Empty,themeOverrides:this.mergedTheme.peerOverrides.Empty})]))}});export{At as N};
